# 비모수 통계 분석 보고서 템플릿

> **목적:** AI 에이전트가 분석 결과를 보고서로 작성할 때 사용하는 고정 목차와 작성 규칙  
> **출력 경로:** `outputs/{run_name}/analysis_report.md`

---

## 보고서 고정 목차

### 1. 분석 목적과 의사결정 질문

- 이 분석을 통해 답하고자 하는 비즈니스 질문을 1~3문장으로 기술
- 예시: "신규 정책 도입 전후로 사용자 반응 지표에 유의한 변화가 있었는가?"

### 2. 데이터 설명

| 항목 | 내용 |
|------|------|
| **분석 기간** | YYYY-MM-DD ~ YYYY-MM-DD |
| **전체 레코드 수** | N건 |
| **분석 대상 레코드 수** | N건 (결측/제외 후) |
| **결측률** | feature별 기재 (예: feature_a 2.1%, feature_b 0%) |
| **제외 기준** | 제외 사유와 건수 기재 |

### 3. 분석 방법 선택 근거

- 왜 비모수 검정을 선택했는지 (정규성 검정 결과, 표본 크기, 데이터 특성)
- 선택한 검정 방법과 그 이유 (spec 의사결정 표 참조)
- 다중검정 보정 방법 (해당시)

> 작성 예시:  
> "Shapiro-Wilk 결과 정규성이 기각되어(W=0.91, p=0.02) Mann-Whitney U를 적용하였다."

### 4. 주요 결과

#### 4.1 결과 요약표

| 검정 | feature | 통계량 | p-value | 보정 p | 효과 크기 | 유의 여부 |
|------|---------|--------|---------|--------|----------|----------|
| (자동 생성: `summary.csv` 기준) | | | | | | |

#### 4.2 주요 시각화

- 각 검정별 차트를 순서대로 배치
- 차트 제목에 검정명과 핵심 통계량 포함
- 파일명 규칙: `figures/{test_name}_{feature}.png`

### 5. 통계 해석

각 유의한 결과에 대해 다음 3가지를 한 문단으로 기술:

1. **유의성:** p-value와 유의 수준 비교
2. **효과 크기:** 크기 판단 (작은/중간/큰) + 실질적 의미
3. **불확실성:** 신뢰구간 또는 Bootstrap SE (해당시)

> 작성 예시:  
> "Mann-Whitney U 결과, 실험군(Mdn=23.5)은 대조군(Mdn=18.2)보다 유의하게 높았다(U=245, Z=2.81, p=0.005, r=0.42). 이는 중간 효과 크기에 해당하며, Bootstrap 95% CI [3.1, 7.8]로 중앙값 차이의 불확실성이 제한적이다."

### 6. 비즈니스 해석

- 통계 결과의 **업무적 의미**를 비전문가도 이해 가능한 언어로 기술
- 영향 범위, 우선순위, 예상 효과를 포함
- 숫자에만 의존하지 말고, 맥락 설명 추가

> 작성 예시:  
> "신규 정책 도입 후 사용자 반응 점수가 유의하게 상승했으며(중앙값 5.3점 증가), 이 향상은 실무적으로도 의미 있는 수준이다."

### 7. 한계와 리스크

다음 중 해당 항목을 반드시 기재:

- [ ] 표본 크기 제한 (검정력 이슈)
- [ ] 비모수 검정의 가정 위반 가능성 (독립성, 대칭성 등)
- [ ] 표본 편향 가능성 (선택 편향, 생존 편향)
- [ ] 다중검정 보정에도 잔여 거짓양성 가능성
- [ ] 변곡점 탐지 결과의 알고리즘 의존성

### 8. 후속 액션

- [ ] 추가 데이터 수집이 필요한 영역
- [ ] A/B 실험 등 인과 검증 계획
- [ ] 모니터링 지표 설정
- [ ] 의사결정 회의 일정

### 9. 재현 정보

| 항목 | 내용 |
|------|------|
| **코드 경로** | `scripts/run_nonparametric_analysis.py` |
| **실행 명령** | `python3 scripts/run_nonparametric_analysis.py --input ... --output ...` |
| **Python 버전** | 3.x.x |
| **주요 패키지 버전** | scipy=x.x, numpy=x.x, pandas=x.x |
| **Random seed** | 42 |
| **실행 일시** | YYYY-MM-DD HH:MM |

---

## 문장 템플릿 모음

### 추세 분석
> "`{feature}`는 기간 [{t0}, {t1}]에서 유의한 {증가/감소} 추세를 보였다(τ={tau}, p={p}, Sen's slope={slope})."

### 변곡점 분석
> "Pettitt 검정 결과 변화점은 t={cp}에서 탐지되었고(p={p}), 전후 중앙값은 {med_before}에서 {med_after}로 변했다."

### 그룹 비교
> "Mann-Whitney U 결과, {G1}(Mdn={med1})과 {G2}(Mdn={med2}) 간 유의한 차이가 나타났다(U={U}, Z={Z}, p={p}, r={r})."

### 대응 비교
> "Wilcoxon 결과, 사전(Mdn={med_pre})과 사후(Mdn={med_post}) 간 유의한 차이가 나타났다(T={T}, p={p}, r={r})."

### 다중 그룹
> "Kruskal-Wallis 결과, 그룹 간 유의한 차이가 나타났다(H({df})={H}, p={p}, η²={eta_sq}). Dunn 사후 검정에서 {GA}와 {GB} 간(p={p_dunn})에서 유의한 차이 확인."

### 상관 분석
> "`{feature_a}`와 `{feature_b}`의 Spearman 상관은 {rho}였고, FDR 보정 후 p-value는 {p_adj}였다."

### 정합성 검증
> "총 {n_total}건 중 규칙 위반은 {n_bad}건({ratio}%)이며, 주요 위반 유형은 {rule_name}이었다."
