# 비모수 분석 패키지 사용 가이드

## 1. 개요
본 문서는 `03_Code/src/nonparametric_analysis` 패키지의 설치, 실행 및 활용 방법을 설명하는 운영 매뉴얼입니다. 이 패키지는 `02_이론가이드`에 기반한 17종의 비모수 통계 분석 기능을 제공합니다.

## 2. 패키지 구조

```text
03_Code/src/nonparametric_analysis/
├── core/                        # 분석 함수 (카테고리별 분리)
│   ├── single_variable.py      #   정규성, 런, 추세, 변곡점, PELT
│   ├── group_comparison.py     #   Mann-Whitney, K-S, Wilcoxon, Kruskal, Friedman
│   ├── correlation.py          #   Spearman, Kendall, Distance 상관분석
│   └── resampling.py           #   Bootstrap, Permutation
├── utils/                       # 유틸리티
│   ├── stats.py                #   통계 헬퍼 (효과 크기, FDR 보정 등)
│   ├── integrity.py            #   데이터 무결성 검사
│   └── sample.py               #   샘플 데이터 생성 로직
├── visualization/
│   └── setup.py                #   한글 폰트/시각화 설정
└── analysis/                    #   기존 import 호환용 래퍼
```

- **`core/`**: 핵심 분석 함수 (17종, 시각화 포함)
- **`utils/`**: 통계 유틸리티 (효과 크기, FDR 보정, 데이터 검증)
- **`visualization/`**: 시각화 스타일 설정 (한글 폰트 지원)
- **`analysis/`**: 기존 import 경로 호환용 (`from nonparametric_analysis.analysis import ...`)

## 3. 실행 방법 (자동화 파이프라인)

터미널에서 아래 명령어로 전체 분석을 수행할 수 있습니다.

```bash
# 기본 실행 (sample 데이터 사용)
python 03_Code/scripts/run_nonparametric_analysis.py

# 옵션 지정 실행
python 03_Code/scripts/run_nonparametric_analysis.py --input "내_데이터.csv" --output "Result_Folder"
```

### 실행 결과물 (`05_Outputs`)
- **`figures/`**: 각 변수별 분석 차트 (PNG 이미지)
- **`summary.csv`**: 전체 분석 결과 요약 (통계량, P-value, 해석 포함)
- **`integrity_check.csv`**: 데이터 결측치/이상치 리포트

## 4. API 활용 가이드 (Python/Notebook)

Jupyter Notebook 등에서 개별 함수를 활용하는 방법입니다.

```python
import sys
from pathlib import Path
import matplotlib.pyplot as plt
import pandas as pd

%matplotlib inline
sys.path.append(str(Path('../03_Code/src').resolve()))

from nonparametric_analysis.analysis import nonparametric_methods as np_methods
from nonparametric_analysis.analysis.visualizations import setup_visualization

setup_visualization() # 시각화 스타일 설정

# 결과 출력 헬퍼 (노트북에 내장됨)
def show_result(res):
    """분석 결과를 보기 좋게 출력하는 헬퍼 함수"""
    for k, v in res.items():
        if k == 'figure':
            continue
        if isinstance(v, pd.DataFrame):
            display(v)
        elif isinstance(v, float):
            print(f"  {k}: {v:.4f}")
        else:
            print(f"  {k}: {v}")
    plt.show()

# 1. 정규성 검정 (Shapiro-Wilk + Plot)
res = np_methods.test_normality(data, name="Feature")
show_result(res)  # 결과 요약 + 차트 출력

# 2. 추세 분석 (Mann-Kendall + Sen's Slope)
res = np_methods.mann_kendall_test(data)
show_result(res)

# 3. 변곡점 탐지 (Pettitt)
res = np_methods.pettitt_test(data)
show_result(res)

# 4. 그룹 비교 (Mann-Whitney U)
res = np_methods.mann_whitney_test(group1, group2, name1="A", name2="B")
show_result(res)
```

> **참고**: `matplotlib.use('Agg')` 대신 `%matplotlib inline`을 사용해야 Jupyter에서 차트가 정상 출력됩니다.

## 5. 주요 분석 기능 목록

| 기능 | 함수명 | 설명 |
|------|-------|------|
| **정규성** | `test_normality` | 히스토그램, Q-Q Plot 제공 |
| **추세** | `mann_kendall_test` | Trend, Slope, 시계열 추세선 |
| **변곡점** | `pettitt_test` | 단일 변곡점 및 전후 중앙값 변화 |
| **그룹차이** | `mann_whitney_test` | 두 그룹 간 순위 기반 차이 분석 |
| | `kruskal_wallis_test` | 세 그룹 이상 비교 (ANOVA 대안) |
| **상관관계** | `spearman_correlation` | 순위 상관계수 및 산점도 |
| | `correlation_matrix_nonparametric` | 변수 간 상관 히트맵 |

## 6. 출력 해석 가이드

분석 결과(`summary.csv`)의 `Interpretation` 컬럼을 참고하세요.
- **p < 0.001**: 매우 강한 유의성 (가설 기각 확실시)
- **p < 0.05**: 유의함 (일반적인 기준에서 가설 기각)
- **p ≥ 0.05**: 유의하지 않음 (가설 기각 실패)

더 자세한 이론적 배경은 `01_Specs/02_비모수_분석_이론가이드.md`를 참고하시기 바랍니다.
